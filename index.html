<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SparkyBot Command Center</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            surface: { 50: '#1a1a2e', 100: '#16213e', 200: '#0f3460', 300: '#252547' },
            amber: { 400: '#f6b93b', 500: '#e58e26', 600: '#d4a017' },
            slate: { 750: '#293548' }
          },
          fontFamily: {
            mono: ['JetBrains Mono', 'monospace'],
            sans: ['DM Sans', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    * { box-sizing: border-box; }
    body { background: #0a0a1a; color: #e2e8f0; font-family: 'DM Sans', sans-serif; margin: 0; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }
    .kanban-column { min-height: calc(100vh - 220px); }
    .card-drag { opacity: 0.5; }
    .drop-target { border: 2px dashed #f6b93b !important; background: rgba(246, 185, 59, 0.05) !important; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    @keyframes slideIn { from { opacity: 0; transform: translateX(-16px); } to { opacity: 1; transform: translateX(0); } }
    .animate-fade { animation: fadeIn 0.3s ease-out; }
    .animate-slide { animation: slideIn 0.25s ease-out; }
    .animate-pulse-slow { animation: pulse 2s infinite; }
    .priority-1 { border-left: 3px solid #ef4444; }
    .priority-2 { border-left: 3px solid #f97316; }
    .priority-3 { border-left: 3px solid #eab308; }
    .priority-4 { border-left: 3px solid #3b82f6; }
    .priority-5 { border-left: 3px solid #6b7280; }
    .glass { background: rgba(22, 33, 62, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.06); }
    .glass-hover:hover { background: rgba(22, 33, 62, 0.8); border-color: rgba(255,255,255,0.12); }
    .btn-amber { background: linear-gradient(135deg, #f6b93b, #e58e26); color: #0a0a1a; font-weight: 600; }
    .btn-amber:hover { background: linear-gradient(135deg, #f9c74f, #f6b93b); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(246,185,59,0.3); }
    .btn-amber:active { transform: translateY(0); }
    .modal-overlay { background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); }
    input, textarea, select {
      background: #1a1a2e; border: 1px solid rgba(255,255,255,0.1); color: #e2e8f0;
      border-radius: 6px; padding: 10px 14px; font-size: 14px; font-family: 'DM Sans', sans-serif; transition: border-color 0.2s;
    }
    input:focus, textarea:focus, select:focus { outline: none; border-color: #f6b93b; box-shadow: 0 0 0 3px rgba(246,185,59,0.15); }
    select option { background: #1a1a2e; }
    .sparkline { fill: none; stroke: #f6b93b; stroke-width: 2; }
    .sparkline-area { fill: url(#sparkGrad); opacity: 0.3; }
    .bubble-user { background: rgba(246, 185, 59, 0.15); border: 1px solid rgba(246, 185, 59, 0.2); border-radius: 16px 16px 4px 16px; }
    .bubble-bot { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.15); border-radius: 16px 16px 16px 4px; }
    .tab-active { border-bottom: 2px solid #f6b93b; color: #f6b93b; }
    .tab-inactive { border-bottom: 2px solid transparent; color: #94a3b8; }
    .tab-inactive:hover { color: #e2e8f0; border-color: rgba(255,255,255,0.1); }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef, useMemo } = React;
    const SUPABASE_URL = 'https://efcgtoyhamxxtpkpaqij.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmY2d0b3loYW14eHRwa3BhcWlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTM5ODIsImV4cCI6MjA4NTI2OTk4Mn0.r-CyaHRLloP15z8a1P8_AOI18L98xq_uLXtQWyyGO6s';
    const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    async function signInWithGoogle() { const { error } = await db.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.origin + window.location.pathname } }); if (error) throw error; }
    async function signOut() { await db.auth.signOut(); }

    const STATUSES = ['backlog', 'todo', 'in_progress', 'review', 'done'];
    const STATUS_CONFIG = { backlog: { label: 'Backlog', emoji: 'üì¶', color: '#6b7280', bg: 'rgba(107,114,128,0.1)' }, todo: { label: 'To Do', emoji: 'üìã', color: '#eab308', bg: 'rgba(234,179,8,0.1)' }, in_progress: { label: 'In Progress', emoji: 'üî®', color: '#3b82f6', bg: 'rgba(59,130,246,0.1)' }, review: { label: 'Review', emoji: 'üîç', color: '#a855f7', bg: 'rgba(168,85,247,0.1)' }, done: { label: 'Done', emoji: '‚úÖ', color: '#22c55e', bg: 'rgba(34,197,94,0.1)' } };
    const PRIORITY_CONFIG = { 1: { label: 'Critical', color: '#ef4444', icon: 'üî¥' }, 2: { label: 'High', color: '#f97316', icon: 'üü†' }, 3: { label: 'Medium', color: '#eab308', icon: 'üü°' }, 4: { label: 'Low', color: '#3b82f6', icon: 'üîµ' }, 5: { label: 'Minimal', color: '#6b7280', icon: '‚ö™' } };
    const ASSIGNEE_PRESETS = { 'claude': { label: 'ü§ñ Claude', color: '#a855f7' }, 'sparky': { label: '‚ö° Sparky', color: '#f6b93b' }, 'both': { label: 'ü§ù Both', color: '#3b82f6' } };
    function getAssigneeDisplay(a) { if (!a) return null; const p = ASSIGNEE_PRESETS[a]; return p || { label: 'üë§ ' + a, color: '#94a3b8' }; }
    function timeAgo(date) { const s = Math.floor((new Date() - new Date(date)) / 1000); if (s < 60) return 'just now'; const m = Math.floor(s / 60); if (m < 60) return m + 'm ago'; const h = Math.floor(m / 60); if (h < 24) return h + 'h ago'; const d = Math.floor(h / 24); if (d < 7) return d + 'd ago'; return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }); }
